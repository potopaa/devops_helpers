# Docker engine on Linux VM

This is a set of demo artifacts to:
* create Google Compute Instance VM
* install Docker engine on the VM

## Prerequisites

1. GCP project exists

2. You are have `Editor` or `Owner` role for the project (this is for simplicity and demo purposes, don't do this in Prod)

3. You are authenticated to GCP like this:

```
gcloud auth application-default login
```

4. You have RSA key pair generated by `ssh-keygen` command, like this:

```
ssh-keygen -t rsa
``` 

5. You added the generated public key to GCP project metadata, like this:

```
gcloud compute project-info add-metadata --metadata-from-file=ssh-keys=[path to public key]
```

## Installation

1. Create Compute Instance:

```
GCP_PROJECT_ID=[your project id]
terraform init
terraform plan -var=project_id=${GCP_PROJECT_ID}
terraform apply -var=project_id=${GCP_PROJECT_ID}
```
2. Save instance external IP address to `hosts` file:
```
terraform output external_ip > hosts
```

3. Download Ansible role from Ansible Galaxy:

```
ansible-galaxy install avinetworks.docker
```

*NOTE:* this role will install Docker Engine on a Linux machine. Code can be found here: https://github.com/avinetworks/ansible-role-docker

4. Run Ansible playbook to install Docker Engine on the created VM:

```
ansible-playbook -i hosts playbook.yml --private-key [path to private key]
```

## Validation

1. SSH to the created VM:

```
ssh <instance external ip> -i [path to private key] 
```

2. Run any Docker container from Docker Hub:

```
docker run hello-world
```

## Clean up

Run the below command to destroy the environment:

```
terraform destroy -var=project_id=${GCP_PROJECT_ID}
```
